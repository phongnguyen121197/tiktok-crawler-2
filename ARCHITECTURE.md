# ðŸ—ï¸ ARCHITECTURE & FLOW VISUALIZATION

## ðŸ“Š SYSTEM ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RAILWAY (Hobby Plan)                      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    FastAPI Application                      â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  Endpoints:                                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ GET  /health                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ GET  /status                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ POST /jobs/daily        â† Main trigger                 â”‚ â”‚
â”‚  â”‚  â””â”€ POST /jobs/crawl-batch                                 â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚          TikTokCrawler (crawler.py)                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   PlaywrightTikTokCrawler                        â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   (playwright_crawler.py)                        â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”‚       Chromium Browser                   â”‚   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”‚  Anti-detection:                 â”‚  â”‚   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”‚  - Real user agent               â”‚  â”‚   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”‚  - No webdriver flags            â”‚  â”‚   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â”‚  - Realistic viewport            â”‚  â”‚   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  LarkClient          GoogleSheetsClient               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  (lark_client.py)    (sheets_client.py)               â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â†“                     â†“                     â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Lark   â”‚          â”‚ TikTok   â”‚         â”‚  Google    â”‚
    â”‚ Bitable â”‚          â”‚ Website  â”‚         â”‚  Sheets    â”‚
    â”‚         â”‚          â”‚          â”‚         â”‚            â”‚
    â”‚ 227     â”‚          â”‚ Public   â”‚         â”‚ Output     â”‚
    â”‚ records â”‚          â”‚ videos   â”‚         â”‚ storage    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ DATA FLOW (Step by Step)

### Phase 1: Initialization (1-2 seconds)

```
User triggers â†’ POST /jobs/daily
                    â†“
         Background task starts
                    â†“
         Initialize all clients:
         â”œâ”€ LarkClient âœ“
         â”œâ”€ GoogleSheetsClient âœ“
         â””â”€ PlaywrightTikTokCrawler âœ“
```

### Phase 2: Fetch from Lark (5-10 seconds)

```
LarkClient.get_all_active_records()
         â†“
  GET https://open.larksuite.com/open-apis/bitable/v1/...
         â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 227 Records from Lark        â”‚
  â”‚                              â”‚
  â”‚ Each record contains:        â”‚
  â”‚  - record_id                 â”‚
  â”‚  - Link air bÃ i (TikTok URL) â”‚
  â”‚  - LÆ°á»£t xem hiá»‡n táº¡i         â”‚
  â”‚  - Sá»‘ view 24h trÆ°á»›c         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
  Store in memory for processing
```

### Phase 3: Crawl TikTok (25-35 minutes) â­ MAIN WORK

```
For each of 227 records:
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Record #1                                â”‚
â”‚ URL: https://tiktok.com/@user/video/123 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
    1. Launch Playwright Browser (if not already)
       â”œâ”€ Set user agent
       â”œâ”€ Set viewport
       â”œâ”€ Add anti-detection scripts
       â””â”€ Create new page
    â†“
    2. Navigate to TikTok URL (5-10s)
       â””â”€ page.goto(url, wait_until='domcontentloaded')
    â†“
    3. Wait for content load (3s)
       â””â”€ await asyncio.sleep(3)
    â†“
    4. Extract view count (1-2s)
       â”œâ”€ Try selector: [data-e2e="video-views"]
       â”œâ”€ Try selector: strong[data-e2e="video-views"]
       â”œâ”€ Try regex: "playCount":(\d+)
       â””â”€ Try JSON-LD structured data
    â†“
    5. Parse count string â†’ integer
       â”œâ”€ "1.2M" â†’ 1,200,000
       â”œâ”€ "52.3K" â†’ 52,300
       â””â”€ "1234" â†’ 1,234
    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âœ… SUCCESS?         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ YES        â†“ NO
   Use crawled    Retry (up to 3 times)
   view count           â†“
   Status:         Still fail?
   "success"            â†“
                   Use Lark data
                   Status: "partial"
    â†“
    6. Build record object:
       {
         record_id: "rec123",
         link: "https://...",
         views: 52372,
         baseline: 14011,
         timestamp: "2025-10-17T10:30:00",
         status: "success"
       }
    â†“
    7. Add 2-second delay
       â””â”€ Avoid rate limiting
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Repeat for Record #2, #3, ... #227      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 4: Update Google Sheets (30-60 seconds)

```
All 227 records processed
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GoogleSheetsClient.batch_update()      â”‚
â”‚                                        â”‚
â”‚ Step 1: Remove existing duplicates    â”‚
â”‚  â”œâ”€ Scan all rows                     â”‚
â”‚  â”œâ”€ Find duplicate record_ids         â”‚
â”‚  â”œâ”€ Keep highest row number           â”‚
â”‚  â””â”€ Delete older duplicates           â”‚
â”‚                                        â”‚
â”‚ Step 2: Update/Insert records         â”‚
â”‚  â”œâ”€ For each record:                  â”‚
â”‚  â”‚   â”œâ”€ If record_id exists â†’ UPDATE â”‚
â”‚  â”‚   â””â”€ If record_id new â†’ INSERT    â”‚
â”‚  â”‚                                    â”‚
â”‚  â””â”€ Batch update (efficient)          â”‚
â”‚                                        â”‚
â”‚ Step 3: Remove new duplicates         â”‚
â”‚  â””â”€ Run dedup logic again             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Sheets Updated                  â”‚
â”‚                                        â”‚
â”‚ Columns:                               â”‚
â”‚  A: Record ID                          â”‚
â”‚  B: TikTok Link                        â”‚
â”‚  C: Current Views (UPDATED) â† NEW     â”‚
â”‚  D: 24h Baseline                       â”‚
â”‚  E: Last Check (UPDATED) â† NEW        â”‚
â”‚  F: Status (success/partial) â† NEW    â”‚
â”‚                                        â”‚
â”‚ Total Rows: 227 (no duplicates)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 5: Complete (1 second)

```
Return summary:
{
  "total": 227,
  "processed": 227,
  "updated": 227,
  "inserted": 0,
  "failed": 0
}
```

---

## â±ï¸ TIMING BREAKDOWN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Activity                         â”‚ Time    â”‚ % Total â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Initialize clients               â”‚   2s    â”‚   0.1%  â”‚
â”‚ Fetch from Lark                  â”‚  10s    â”‚   0.4%  â”‚
â”‚ Crawl 227 videos                 â”‚ 35min   â”‚  97.2%  â”‚ â† MAIN
â”‚ Update Google Sheets             â”‚  45s    â”‚   2.1%  â”‚
â”‚ Cleanup & return                 â”‚   5s    â”‚   0.2%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                            â”‚ 36min   â”‚  100%   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Per Video Breakdown:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Launch browser (once)      â”‚  2s   â”‚
â”‚ Navigate to URL           â”‚  5s   â”‚
â”‚ Wait for load             â”‚  3s   â”‚
â”‚ Extract view count        â”‚  2s   â”‚
â”‚ Retry if failed (avg)     â”‚  0s   â”‚ (most succeed first try)
â”‚ Delay between videos      â”‚  2s   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Average per video         â”‚ ~9.5s â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

227 videos Ã— 9.5s = 2,156s â‰ˆ 36 minutes
```

---

## ðŸŽ¯ SUCCESS/FAILURE PATHS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Start Crawling  â”‚
â”‚   Video URL     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Attempt 1          â”‚
â”‚ Load page & extractâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚SUCCESS â”‚ â”‚  FAIL    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â†“
    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Wait 3 seconds â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â†“
    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Attempt 2  â”‚
    â”‚      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚      â†“         â†“
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
    â”‚   â”‚SUCCESS â”‚ â”‚FAIL â”‚
    â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜
    â”‚       â”‚         â”‚
    â”‚       â”‚         â†“
    â”‚       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚    â”‚ Attempt 3  â”‚
    â”‚       â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚       â”‚         â”‚
    â”‚       â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚       â”‚    â†“         â†“
    â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚ â”‚SUCCESS â”‚ â”‚ FAIL ALL â”‚
    â”‚       â”‚ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚       â”‚     â”‚           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Use Result:   â”‚
         â”‚                â”‚
         â”‚  If SUCCESS:   â”‚
         â”‚  - views: 52372â”‚
         â”‚  - status: OK  â”‚
         â”‚                â”‚
         â”‚  If FAIL ALL:  â”‚
         â”‚  - views: from â”‚
         â”‚    Lark data   â”‚
         â”‚  - status:     â”‚
         â”‚    partial     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ’¾ MEMORY USAGE PROFILE

```
Railway Hobby Plan: 8GB RAM available

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component                  â”‚ Memory    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FastAPI App               â”‚  50 MB    â”‚
â”‚ Python Runtime            â”‚  30 MB    â”‚
â”‚ Lark Client               â”‚  10 MB    â”‚
â”‚ Google Sheets Client      â”‚  15 MB    â”‚
â”‚ Playwright Crawler        â”‚  20 MB    â”‚
â”‚ Chromium Browser (active) â”‚ 300 MB    â”‚ â† Largest
â”‚ Page instance             â”‚  50 MB    â”‚
â”‚ Data buffers              â”‚  25 MB    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL PEAK USAGE          â”‚ 500 MB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Available: 8000 MB
Used:       500 MB
Free:      7500 MB
Usage:        6% â† Very comfortable!
```

---

## ðŸ”’ ANTI-DETECTION MEASURES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFENSE LAYER 1: Browser Configuration      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Real user agent (Chrome 120)              â”‚
â”‚ âœ“ Standard viewport (1920x1080)             â”‚
â”‚ âœ“ Locale & timezone (en-US, Asia/HCM)       â”‚
â”‚ âœ“ No automation flags                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFENSE LAYER 2: JavaScript Injection       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Remove navigator.webdriver flag           â”‚
â”‚ âœ“ Mock plugins array                         â”‚
â”‚ âœ“ Set languages properly                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEFENSE LAYER 3: Behavioral Patterns        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ 2-3 second delays between requests        â”‚
â”‚ âœ“ Realistic page load times                 â”‚
â”‚ âœ“ Sequential crawling (not parallel)        â”‚
â”‚ âœ“ Retry with exponential backoff            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: Appears as human visitor to TikTok
```

---

## ðŸ“Š ERROR HANDLING STRATEGY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Error Type          â”‚ Handling         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Network timeout    â”‚ Retry 3x         â”‚
â”‚ Element not found  â”‚ Try alt selector â”‚
â”‚ Browser crash      â”‚ Restart browser  â”‚
â”‚ Rate limit (429)   â”‚ Wait & retry     â”‚
â”‚ Video private      â”‚ Use Lark data    â”‚
â”‚ Video deleted      â”‚ Use Lark data    â”‚
â”‚ Invalid URL        â”‚ Skip & log       â”‚
â”‚ Parse error        â”‚ Try alt parser   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Fallback Chain:
1. Playwright crawl
   â†“ fails
2. Retry (3 attempts)
   â†“ fails
3. Use Lark data
   â†“ 
4. Mark status "partial"
   â†“
5. Continue with next video
```

---

## ðŸŽ¯ COMPARISON: OLD vs NEW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚  OLD (TikWM API)    â”‚  NEW (Playwright)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Source  â”‚ Third-party API     â”‚ Direct TikTok scraping â”‚
â”‚ Reliability  â”‚ 0% (blocked)        â”‚ 80-90% success rate    â”‚
â”‚ Speed/video  â”‚ 0.5s (when worked)  â”‚ 9.5s per video         â”‚
â”‚ Total time   â”‚ 2-3 min (theory)    â”‚ 36 min (actual)        â”‚
â”‚ Cost         â”‚ $0 (but doesn't workâ”‚ $5/month Railway       â”‚
â”‚ Maintenance  â”‚ Easy (if works)     â”‚ Medium                 â”‚
â”‚ Scalability  â”‚ Limited by API      â”‚ Limited by time        â”‚
â”‚ Data quality â”‚ N/A (doesn't work)  â”‚ Real-time, accurate    â”‚
â”‚ Rate limits  â”‚ Unknown             â”‚ TikTok rate limits     â”‚
â”‚ Setup        â”‚ Simple              â”‚ Moderate complexity    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Trade-off Analysis:
  Speed:     API faster (but blocked) âœ—
  Cost:      Playwright cheaper long-term âœ“
  Reliability: Playwright much better âœ“âœ“âœ“
  Maintenance: Playwright needs more care âœ—
  Data:      Playwright gives real data âœ“âœ“âœ“

VERDICT: Playwright is better choice for your use case âœ“
```

---

## ðŸš€ DEPLOYMENT FLOW

```
Local Machine                    Git Repo                Railway Cloud
     â”‚                              â”‚                          â”‚
     â”‚  1. git add .               â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
     â”‚  2. git commit              â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
     â”‚  3. git push                â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ 4. Webhook trigger       â”‚
     â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
     â”‚                              â”‚                          â”‚
     â”‚                              â”‚  5. Pull code            â”‚
     â”‚                              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                              â”‚                          â”‚
     â”‚                              â”‚  6. Build:               â”‚
     â”‚                              â”‚     pip install -r ...   â”‚
     â”‚                              â”‚     playwright install   â”‚
     â”‚                              â”‚                   [3 min]â”‚
     â”‚                              â”‚                          â”‚
     â”‚                              â”‚  7. Start:               â”‚
     â”‚                              â”‚     uvicorn app...       â”‚
     â”‚                              â”‚                    [10s] â”‚
     â”‚                              â”‚                          â”‚
     â”‚                              â”‚  8. Health check         â”‚
     â”‚                              â”‚     GET /health          â”‚
     â”‚                              â”‚                    âœ“ OK  â”‚
     â”‚                              â”‚                          â”‚
     â”‚  9. Deployment complete!     â”‚                          â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                          â”‚
     â”‚ 10. Trigger crawl:                                      â”‚
     â”‚     POST /jobs/daily                                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                          â”‚
     â”‚                                    11. Background job:  â”‚
     â”‚                                        - Fetch Lark     â”‚
     â”‚                                        - Crawl TikTok   â”‚
     â”‚                                        - Update Sheets  â”‚
     â”‚                                              [36 min]   â”‚
     â”‚                                                          â”‚
     â”‚ 12. Check results in Google Sheets                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
```

---

ÄÃ¢y lÃ  visualization chi tiáº¿t cá»§a toÃ n bá»™ há»‡ thá»‘ng! 
GiÃºp báº¡n hiá»ƒu rÃµ tá»«ng bÆ°á»›c vÃ  cÃ¡ch má»i thá»© hoáº¡t Ä‘á»™ng. ðŸŽ¨
